%{!?python_sitelib: %global python_sitelib %(%{__python} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")}

# disable debuginfo
%define debug_package %{nil}

%define pkgconfdir      %{_sysconfdir}/%{name}.d


Name:           miniascape
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Personal cloud building and management tool
Group:          Development/Tools
License:        GPLv3+
URL:            https://github.com/ssato/miniascape
Source0:        https://github.com/ssato/%{name}/tarball/master/%{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildArch:      noarch
BuildRequires:  python
Requires:       python-anyconfig >= 0.0.3.4
Requires:       python-jinja2-cli >= 0.0.4.1


%description
Personal cloud building and management tool for libvirt/KVM.


%package        data-default
Summary:        Default guests and infra data files for %{name}
Requires:       %{name} = %{version}-%{release}


%description    data-default
Some default guests and infra data files for %{name}.


%prep
%setup -q


%build
%{__python} setup.py build


%install
rm -rf $RPM_BUILD_ROOT
%{__python} setup.py install -O1 --skip-build --root $RPM_BUILD_ROOT

# Make egg-info not included in this package:
rm -f $RPM_BUILD_ROOT%{python_sitelib}/*.egg-info


%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%doc README.rst
%{_bindir}/*
%{_datadir}/%{name}/templates
%{_datadir}/%{name}/templates/autoinstall.d/*-ks.cfg
%{_datadir}/%{name}/templates/autoinstall.d/*/*
%{_datadir}/%{name}/templates/host/*
%{python_sitelib}/*


%files          data-default
%defattr(-,root,root,-)
%doc README.rst
%config %{pkgconfdir}/default/*/*.yml
%config %{pkgconfdir}/default/*/*/*.yml
%{pkgconfdir}/default/*/*/README


%changelog
* Wed Feb 13 2013 Satoru SATOH <ssato@redhat.com> - 0.3.5-1
- Added a set of JBoss AS 7 guests' config and template files
- Added RHEV Manager and Hypervisor guests' config and template files
- Added 'ssh.pubkey' to install it as guest:/root/.ssh/authorized_keys
- Fixed some bugs in Red Hat Cluster and GFS guests' data
- Fixed a bug that files for host not generated except for network files
- Some RPM SPEC cleanups; removed some dupliated files in %files, etc.
- Removed RHUI related guests data; now these are kept maintained at
  https://github.com/ssato/miniascape-data-default-rhui
- Switched template rendering module from python-jinja2-cui to python-jinja2-cli

* Wed Dec 12 2012 Satoru SATOH <ssato@redhat.com> - 0.3.4-1
- Splitted into some RPMs and separated miniascape and its data files
- Fixed bugs in RHUI guests' data
- Fixed and enhanced GFS guests' data to make it works w/ just few config steps
- Fixed a bug that files for host not generated except for network files

* Thu Nov 29 2012 Satoru SATOH <ssato@redhat.com> - 0.3.3-1
- Added some more VM configs and templates such like RHEL 6 LVS and Real servers
- Replaced simple and hardcoded conf search paths w/ config-based (metaconfig)
- Re-organized modules relations and do some refacotrings
- A lot of cleanup and bug fixes in templates and configs

* Fri Sep 21 2012 Satoru SATOH <ssato@redhat.com> - 0.3.2-1
- Fixed a bug in miniascape.guest lacks of the module import line
- Added some more VM configs and templates such like RHEL 6 cluster, RHUI clients
- Implemented duplicate entries check for IP and MAC address in guest configs
- A lot of cleanup and bug fixes in templates and configs
- And misc bug fixed and enhancements

* Fri Sep  7 2012 Satoru SATOH <ssato@redhat.com> - 0.3.1-1
- Allow multiple configurations per guest and splitted some guests config
- Fixed whitespaces problme in some templates such as vmbuild.sh
- Added some hacks to create multi disk images, avoiding issue of rhbz#857424
- Made it depends on the latest python-jinja2-cui >= 0.0.3.12
- Fixed files list in rpm spec

* Thu Aug 30 2012 Satoru SATOH <ssato@redhat.com> - 0.3.0-1
- Initial packaging
